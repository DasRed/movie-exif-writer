<html lang="de">
<head>
    <title>Movie Exif</title>
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="./@fortawesome/fontawesome-free/css/all.css" />
</head>
<body>
    <h1>
        Queue
    </h1>
    <ul>
        <li>Waiting: <span id="waiting"></span></li>
        <li>Requesting: <span id="requesting"></span></li>
        <li>Requested: <span id="requested"></span></li>
        <li>Request in: <span id="requestIn"></span></li>
    </ul>

    <hr>

    <div id="form">
        <label for="path">Scan path: </label><input type="text" id="path" value="/Volumes/Media/Movies/2004"/>
        <button id="button" type="button">Scan</button>
    </div>

    <hr>

    <table>
        <thead>
        <tr>
            <th>Status</th>
            <th>Titles</th>
            <th>Year?</th>
            <th>Suggestion</th>
        </tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

    <script type="text/html" id="templateLine">
        <tr id="m-${file.id}"
            class="
                <% if (file.status === 'error') { %>red<% }
                else if (file.metaTitle && file.metaYear) { %>grey<% }
                else if (file.status === 'success' && file.movies.length === 0) { %>orange<% } %>
            "
        >
            <td><i class="fas <%
                if (file.status === 'waiting') { %>fa-pause-circle blue<% }
                else if (file.status === 'requesting') { %>fa-spinner fa-spin orange<% }
                else if (file.status === 'success') { %>fa-check-circle green<% }
                else if (file.status === 'error') { %>fa-exclamation-circle red<% }
                else {%>fa-question-circle<% } %>"></i></td>
            <td>
                File: ${file.path}/${file.name}<br />
                Possible Title: ${file.possibleTitle}<br />
                Meta Title: ${file.metaTitle}<br />
            </td>
            <td>
                Possible Year: ${file.possibleYear}<br />
                Meta Year: ${file.metaYear}
            </td>
            <td>
                <% if (file.status === 'error') { %>
                    ${file.message}
                <% } else if (file.status === 'success') { %>
                    <ul>
                        <li>
                            <input
                                    type="radio"
                                    name="m-${file.id}"
                                    value="-1"
                                    data-year=""
                                    data-title=""
                                    <% if (file.metaTitle && file.metaYear) {%>checked="checked"<% } %>
                            > ignore
                        </li>
                        <% file.movies.forEach(function (movie, index) { %>
                            <li>
                                <input
                                        type="radio"
                                        data-index="${index}"
                                        name="m-${file.id}"
                                        value="${movie.year} : ${movie.title}"
                                        data-year="${movie.year}"
                                        data-title="${movie.title}"
                                        <% if (!(file.metaTitle && file.metaYear) && index === 0) {%>checked="checked"<% } %>
                                > ${movie.year} : ${movie.title}
                            </li>
                        <% }) %>
                    </ul>
                <% } %>
            </td>
        </tr>
    </script>

    <script type="module">
        import Client from '/index.mjs';
        import $ from './jquery.mjs';

        new Client({
            url:      'ws://localhost:3000',
            element:  {
                list:       $('#list'),
                waiting:    $('#waiting'),
                requesting: $('#requesting'),
                requested:  $('#requested'),
                requestIn:  $('#requestIn'),
                input:      $('#path'),
                button:     $('#button'),
            },
            template: {
                line: document.getElementById('templateLine').innerHTML,
            }
        });
    </script>
</body>
</html>
